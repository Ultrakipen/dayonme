# =============================================================================
# iExist 크론탭 설정 예시
# crontab -e 명령으로 편집
# =============================================================================

# 환경 변수 설정
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=admin@your-domain.com

# -----------------------------------------------------------------------------
# 데이터베이스 백업
# -----------------------------------------------------------------------------

# 매일 새벽 2시에 일일 백업
0 2 * * * /var/www/iexist/backend/scripts/backup-db.sh daily >> /var/log/iexist/backup.log 2>&1

# 매주 일요일 새벽 3시에 주간 백업
0 3 * * 0 /var/www/iexist/backend/scripts/backup-db.sh weekly >> /var/log/iexist/backup.log 2>&1

# -----------------------------------------------------------------------------
# 로그 로테이션 (시스템 logrotate 사용 권장)
# -----------------------------------------------------------------------------

# 매일 자정에 오래된 로그 정리
0 0 * * * find /var/www/iexist/backend/logs -name "*.log" -type f -mtime +30 -delete

# -----------------------------------------------------------------------------
# 헬스 체크
# -----------------------------------------------------------------------------

# 매 5분마다 서버 헬스 체크
*/5 * * * * curl -sf http://localhost:3001/health > /dev/null || systemctl restart iexist-backend

# -----------------------------------------------------------------------------
# SSL 인증서 갱신 (Let's Encrypt)
# -----------------------------------------------------------------------------

# 매일 새벽 4시에 인증서 갱신 시도
0 4 * * * certbot renew --quiet && systemctl reload nginx

# -----------------------------------------------------------------------------
# 캐시 정리
# -----------------------------------------------------------------------------

# 매일 새벽 5시에 임시 파일 정리
0 5 * * * find /tmp -name "iexist_*" -type f -mtime +1 -delete

# 매주 토요일 새벽 4시에 Redis 캐시 정리 (선택적)
# 0 4 * * 6 redis-cli FLUSHDB

# -----------------------------------------------------------------------------
# 디스크 공간 모니터링
# -----------------------------------------------------------------------------

# 매 시간마다 디스크 사용량 체크 (90% 이상 시 알림)
0 * * * * df -h / | awk 'NR==2 {if(int($5) > 90) print "Disk space warning: " $5}' | mail -s "iExist Disk Alert" admin@your-domain.com

# -----------------------------------------------------------------------------
# 시스템 업데이트 (보안 패치만)
# -----------------------------------------------------------------------------

# 매주 일요일 새벽 1시에 보안 업데이트 (Ubuntu/Debian)
# 0 1 * * 0 apt-get update && apt-get upgrade -y --only-upgrade

# -----------------------------------------------------------------------------
