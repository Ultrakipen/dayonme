import db from '../models';
const { SomeoneDayPost, Tag, SomeoneDayTag, sequelize } = db;

interface TestPostData {
  title: string;
  content: string;
  summary: string;
  is_anonymous: boolean;
  user_id: number;
  tags: string[];
}

const testPosts: TestPostData[] = [
  {
    title: "í˜ë“  í•˜ë£¨ë¥¼ ë³´ë‚´ê³  ìˆì–´ìš”",
    content: "ì˜¤ëŠ˜ íšŒì‚¬ì—ì„œ ì •ë§ í˜ë“  ì¼ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ìƒì‚¬í•œí…Œ í˜¼ë‚˜ê³ , ë™ë£Œë“¤ê³¼ë„ ê°ˆë“±ì´ ìƒê¸°ê³ ... ì§‘ì— ì™€ì„œë„ ê³„ì† ë§ˆìŒì´ ë¬´ê±°ì›Œìš”. ì´ëŸ° ë‚ ì—” ì–´ë–»ê²Œ í•´ì•¼ ë§ˆìŒì´ í¸í•´ì§ˆê¹Œìš”? í˜¹ì‹œ ë¹„ìŠ·í•œ ê²½í—˜ ìˆìœ¼ì‹  ë¶„ë“¤ ì¡°ì–¸ ë¶€íƒë“œë ¤ìš”.",
    summary: "íšŒì‚¬ì—ì„œ í˜ë“  ì¼ì´ ìˆì—ˆê³  ë§ˆìŒì´ ë¬´ê±°ìš´ í•˜ë£¨ë¥¼ ë³´ë‚´ê³  ìˆìŠµë‹ˆë‹¤.",
    is_anonymous: true,
    user_id: 2036,
    tags: ["ì§ì¥ìŠ¤íŠ¸ë ˆìŠ¤", "ê³ ë¯¼"]
  },
  {
    title: "ìƒˆë¡œìš´ ì‹œì‘ì´ ë‘ë ¤ì›Œìš”",
    content: "ë‹¤ìŒ ë‹¬ì— ìƒˆë¡œìš´ ì§ì¥ìœ¼ë¡œ ì´ì§ì„ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì¢‹ì€ ê¸°íšŒë¼ê³  ìƒê°í•˜ì§€ë§Œ í•œí¸ìœ¼ë¡œëŠ” ë„ˆë¬´ ë‘ë ¤ì›Œìš”. ìƒˆë¡œìš´ í™˜ê²½, ìƒˆë¡œìš´ ì‚¬ëŒë“¤... ì˜ ì ì‘í•  ìˆ˜ ìˆì„ê¹Œìš”? ì´ì§ ê²½í—˜ì´ ìˆìœ¼ì‹  ë¶„ë“¤ì˜ ì¡°ì–¸ì„ ë“£ê³  ì‹¶ì–´ìš”.",
    summary: "ìƒˆë¡œìš´ ì§ì¥ìœ¼ë¡œì˜ ì´ì§ì´ ë‘ë µê³  ì¡°ì–¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
    is_anonymous: false,
    user_id: 2036,
    tags: ["ì´ì§", "ë‘ë ¤ì›€", "ìƒˆë¡œìš´ì‹œì‘"]
  },
  {
    title: "ì¹œêµ¬ì™€ì˜ ê´€ê³„ì—ì„œ ìƒì²˜ë°›ì•˜ì–´ìš”",
    content: "ê°€ì¥ ì¹œí•œ ì¹œêµ¬ë¼ê³  ìƒê°í–ˆëŠ”ë°, ë’¤ì—ì„œ ì œ í‰ì„ ë³¸ë‹¤ëŠ” ê±¸ ì•Œê²Œ ë˜ì—ˆì–´ìš”. ë„ˆë¬´ ì¶©ê²©ì ì´ê³  ë°°ì‹ ê°ì´ ë“¤ì–´ì„œ ì ë„ ëª» ìê³  ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ìš”. ìš©ì„œí•´ì•¼ í• ê¹Œìš”, ì•„ë‹ˆë©´ ê´€ê³„ë¥¼ ì •ë¦¬í•´ì•¼ í• ê¹Œìš”?",
    summary: "ì¹œí•œ ì¹œêµ¬ì˜ ë°°ì‹ ìœ¼ë¡œ ìƒì²˜ë°›ì•„ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ê³ ë¯¼ë©ë‹ˆë‹¤.",
    is_anonymous: true,
    user_id: 2036,
    tags: ["ìš°ì •", "ë°°ì‹ ", "ì¸ê°„ê´€ê³„"]
  },
  {
    title: "ìì‹ ê°ì„ ìƒì—ˆì–´ìš”",
    content: "ìµœê·¼ ë“¤ì–´ ë­˜ í•´ë„ ì˜ ì•ˆë˜ê³ , ì‹¤ìˆ˜ë§Œ ì—°ë°œí•˜ê³  ìˆì–´ìš”. ì˜ˆì „ì—ëŠ” ìì‹ ê°ì´ ë„˜ì³¤ëŠ”ë° ì§€ê¸ˆì€ ë­˜ í•´ë„ 'ë‚´ê°€ ì´ê±¸ ì œëŒ€ë¡œ í•  ìˆ˜ ìˆì„ê¹Œ?' í•˜ëŠ” ìƒê°ë§Œ ë“¤ì–´ìš”. ìì‹ ê°ì„ ë˜ì°¾ëŠ” ë°©ë²•ì´ ìˆì„ê¹Œìš”?",
    summary: "ìµœê·¼ ì‹¤ìˆ˜ê°€ ì¦ì•„ì§€ë©´ì„œ ìì‹ ê°ì„ ë§ì´ ìƒì—ˆìŠµë‹ˆë‹¤.",
    is_anonymous: false,
    user_id: 2036,
    tags: ["ìì‹ ê°", "ì‹¤íŒ¨", "ì„±ì¥"]
  },
  {
    title: "ê°€ì¡±ê³¼ì˜ ê°ˆë“±ì´ ê¹Šì–´ì ¸ìš”",
    content: "ë¶€ëª¨ë‹˜ê³¼ ì§„ë¡œ ë¬¸ì œë¡œ ê³„ì† ê°ˆë“±ì„ ê²ªê³  ìˆì–´ìš”. ì œê°€ í•˜ê³  ì‹¶ì€ ì¼ì´ ìˆëŠ”ë° ë¶€ëª¨ë‹˜ì€ ë°˜ëŒ€í•˜ì‹œê³ ... ì„œë¡œ ì´í•´í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì´ ê³„ì†ë˜ê³  ìˆìŠµë‹ˆë‹¤. ê°€ì¡±ì´ë‹ˆê¹Œ í¬ê¸°í•  ìˆ˜ë„ ì—†ê³ , ê·¸ë ‡ë‹¤ê³  ì œ ê¿ˆì„ í¬ê¸°í•  ìˆ˜ë„ ì—†ê³ ... ì •ë§ ë‹µë‹µí•´ìš”.",
    summary: "ë¶€ëª¨ë‹˜ê³¼ ì§„ë¡œ ë¬¸ì œë¡œ ê°ˆë“±ì„ ê²ªê³  ìˆì–´ ë‹µë‹µí•©ë‹ˆë‹¤.",
    is_anonymous: true,
    user_id: 2036,
    tags: ["ê°€ì¡±ê°ˆë“±", "ì§„ë¡œ", "ê¿ˆ"]
  },
  {
    title: "ì™¸ë¡œì›€ì´ ë„ˆë¬´ ì»¤ìš”",
    content: "í˜¼ì ì‚¬ëŠ” ê²Œ ì´ë ‡ê²Œ ì™¸ë¡œìš¸ ì¤„ ëª°ëì–´ìš”. íŠ¹íˆ ì£¼ë§ì´ë‚˜ ì €ë…ì‹œê°„ì— í˜¼ì ìˆìœ¼ë©´ ì •ë§ ì“¸ì“¸í•´ì ¸ìš”. ì¹œêµ¬ë“¤ì€ ê°ì ë°”ì˜ê³ , ì—°ì¸ë„ ì—†ê³ ... ì´ ì™¸ë¡œì›€ì„ ì–´ë–»ê²Œ ë‹¬ë˜ì•¼ í• ê¹Œìš”? í˜¼ìì„œë„ í–‰ë³µí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì„ê¹Œìš”?",
    summary: "í˜¼ì ì‚¬ëŠ” ì‚¶ì—ì„œ ëŠë¼ëŠ” ì™¸ë¡œì›€ì´ ë„ˆë¬´ ì»¤ì„œ ê³ ë¯¼ì…ë‹ˆë‹¤.",
    is_anonymous: true,
    user_id: 2036,
    tags: ["ì™¸ë¡œì›€", "í˜¼ìì‚´ê¸°", "ì“¸ì“¸í•¨"]
  },
  {
    title: "ê±´ê°• ë¬¸ì œë¡œ ë¶ˆì•ˆí•´ìš”",
    content: "ìµœê·¼ ê±´ê°•ê²€ì§„ì—ì„œ ì´ìƒ ì†Œê²¬ì´ ë‚˜ì™”ì–´ìš”. í° ë¬¸ì œëŠ” ì•„ë‹ˆë¼ê³  í•˜ì§€ë§Œ ê³„ì† ì‹ ê²½ì´ ì“°ì´ê³  ë¶ˆì•ˆí•´ìš”. ì¸í„°ë„·ìœ¼ë¡œ ê²€ìƒ‰í•˜ë©´ ë” ë¬´ì„œìš´ ì´ì•¼ê¸°ë“¤ë§Œ ë‚˜ì˜¤ê³ ... ì–´ë–»ê²Œ ë§ˆìŒì„ ë‹¤ìŠ¤ë ¤ì•¼ í• ê¹Œìš”?",
    summary: "ê±´ê°•ê²€ì§„ ê²°ê³¼ë¡œ ì¸í•œ ë¶ˆì•ˆê°ìœ¼ë¡œ ê³ ë¯¼í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
    is_anonymous: false,
    user_id: 2036,
    tags: ["ê±´ê°•", "ë¶ˆì•ˆ", "ê±±ì •"]
  },
  {
    title: "ë¯¸ë˜ê°€ ë§‰ë§‰í•´ìš”",
    content: "20ëŒ€ í›„ë°˜ì¸ë° ì•„ì§ë„ ë­˜ í•˜ê³  ì‹¶ì€ì§€, ì–´ë–»ê²Œ ì‚´ì•„ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ìš”. ì£¼ë³€ ì¹œêµ¬ë“¤ì€ ë‹¤ë“¤ í™•ì‹¤í•œ ëª©í‘œê°€ ìˆì–´ ë³´ì´ëŠ”ë° ì €ë§Œ ê¸¸ì„ ìƒì€ ê²ƒ ê°™ì•„ìš”. ì´ëŸ° ì œê°€ ì´ìƒí•œ ê±´ê°€ìš”? ì–´ë–»ê²Œ í•˜ë©´ ì œ ê¸¸ì„ ì°¾ì„ ìˆ˜ ìˆì„ê¹Œìš”?",
    summary: "ë¯¸ë˜ì— ëŒ€í•œ í™•ì‹¤í•œ ë°©í–¥ì„ ì°¾ì§€ ëª»í•´ ë§‰ë§‰í•œ ìƒí™©ì…ë‹ˆë‹¤.",
    is_anonymous: true,
    user_id: 2036,
    tags: ["ë¯¸ë˜", "ë°©í–¥ì„±", "ì§„ë¡œê³ ë¯¼"]
  }
];

const comfortTags = [
  "ì§ì¥ìŠ¤íŠ¸ë ˆìŠ¤", "ê³ ë¯¼", "ì´ì§", "ë‘ë ¤ì›€", "ìƒˆë¡œìš´ì‹œì‘", 
  "ìš°ì •", "ë°°ì‹ ", "ì¸ê°„ê´€ê³„", "ìì‹ ê°", "ì‹¤íŒ¨", "ì„±ì¥",
  "ê°€ì¡±ê°ˆë“±", "ì§„ë¡œ", "ê¿ˆ", "ì™¸ë¡œì›€", "í˜¼ìì‚´ê¸°", "ì“¸ì“¸í•¨",
  "ê±´ê°•", "ë¶ˆì•ˆ", "ê±±ì •", "ë¯¸ë˜", "ë°©í–¥ì„±", "ì§„ë¡œê³ ë¯¼"
];

async function createComfortTestData() {
  try {
    console.log('ğŸš€ ìœ„ë¡œì™€ ê³µê° í˜ì´ì§€ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹œì‘...');

    // íŠ¸ëœì­ì…˜ ì‹œì‘
    const transaction = await sequelize.transaction();

    try {
      // 1. íƒœê·¸ ìƒì„±
      console.log('ğŸ“ íƒœê·¸ ìƒì„± ì¤‘...');
      const tagPromises = comfortTags.map(async (tagName) => {
        const [tag] = await Tag.findOrCreate({
          where: { name: tagName },
          defaults: { name: tagName },
          transaction
        });
        return tag;
      });
      
      const tags = await Promise.all(tagPromises);
      console.log(`âœ… ${tags.length}ê°œì˜ íƒœê·¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);

      // 2. ê²Œì‹œë¬¼ ìƒì„±
      console.log('ğŸ“š ê²Œì‹œë¬¼ ìƒì„± ì¤‘...');
      for (let i = 0; i < testPosts.length; i++) {
        const postData = testPosts[i];
        
        const post = await SomeoneDayPost.create({
          title: postData.title,
          content: postData.content,
          summary: postData.summary,
          is_anonymous: postData.is_anonymous,
          user_id: postData.user_id,
          character_count: postData.content.length,
          like_count: Math.floor(Math.random() * 20) + 1, // 1-20 ëœë¤ ì¢‹ì•„ìš”
          comment_count: Math.floor(Math.random() * 10), // 0-9 ëœë¤ ëŒ“ê¸€
          created_at: new Date(Date.now() - (i * 1000 * 60 * 60 * 24)), // í•˜ë£¨ì”© ì°¨ì´ë‚˜ê²Œ
        }, { transaction });

        // 3. ê²Œì‹œë¬¼-íƒœê·¸ ì—°ê²°
        for (const tagName of postData.tags) {
          const tag = tags.find(t => t.name === tagName);
          if (tag) {
            await SomeoneDayTag.create({
              post_id: post.post_id,
              tag_id: tag.tag_id
            }, { transaction });
          }
        }

        console.log(`âœ… ê²Œì‹œë¬¼ "${postData.title}" ìƒì„± ì™„ë£Œ`);
      }

      // íŠ¸ëœì­ì…˜ ì»¤ë°‹
      await transaction.commit();

      console.log('ğŸ‰ ìœ„ë¡œì™€ ê³µê° í˜ì´ì§€ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ!');
      console.log(`ğŸ“Š ìƒì„±ëœ ë°ì´í„°: ${testPosts.length}ê°œ ê²Œì‹œë¬¼, ${tags.length}ê°œ íƒœê·¸`);

    } catch (error) {
      await transaction.rollback();
      throw error;
    }

  } catch (error) {
    console.error('âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    throw error;
  }
}

// ìŠ¤í¬ë¦½íŠ¸ê°€ ì§ì ‘ ì‹¤í–‰ë  ë•Œ
if (require.main === module) {
  createComfortTestData()
    .then(() => {
      console.log('âœ¨ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
      process.exit(0);
    })
    .catch((error) => {
      console.error('ğŸ’¥ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹¤íŒ¨:', error);
      process.exit(1);
    });
}

export { createComfortTestData };