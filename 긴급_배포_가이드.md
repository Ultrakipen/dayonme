# 긴급 APK 빌드 및 배포 가이드

## 🚨 현재 상황
- 운영 중인 서비스에서 오류 발생
- 로컬 Windows 환경에서 빌드 실패 (C++20 호환성 문제)
- 긴급 수정 및 배포 필요

## ✅ 즉시 실행 가능한 해결책

### 방법 1: GitHub Actions 자동 빌드 (권장 - 15분 소요)

#### 1. GitHub Secrets 설정 (최초 1회만)

GitHub 저장소 → Settings → Secrets and variables → Actions

다음 Secrets 추가:

```
API_URL: https://api.dayonme.co.kr
KAKAO_NATIVE_APP_KEY: (카카오 앱 키)
NAVER_CLIENT_ID: (네이버 클라이언트 ID)
NAVER_CLIENT_SECRET: (네이버 시크릿)
ONESIGNAL_APP_ID: (원시그널 앱 ID)

# Release 서명을 위한 Keystore (선택)
KEYSTORE_BASE64: (release.keystore 파일을 base64로 인코딩)
KEYSTORE_PASSWORD: (키스토어 비밀번호)
KEY_ALIAS: (키 별칭)
KEY_PASSWORD: (키 비밀번호)
```

**Keystore를 Base64로 변환하는 방법:**

Windows PowerShell:
```powershell
[Convert]::ToBase64String([IO.File]::ReadAllBytes("C:\app_build\Iexist\frontend\android\app\release.keystore"))
```

Git Bash:
```bash
base64 C:/app_build/Iexist/frontend/android/app/release.keystore
```

#### 2. 코드 Push

```bash
cd C:\app_build\Iexist

# 변경사항 커밋
git add .github/workflows/android-build.yml
git commit -m "Add GitHub Actions workflow for emergency APK build"

# Push
git push origin main
```

#### 3. GitHub에서 빌드 확인

1. GitHub 저장소 → **Actions** 탭
2. "Build Android APK" 워크플로우 클릭
3. 빌드 진행 상황 확인 (약 10-15분 소요)

#### 4. APK 다운로드

빌드 완료 후:
1. 워크플로우 실행 페이지에서 **Artifacts** 섹션 확인
2. **app-release** 다운로드
3. 압축 해제하면 `app-release.apk` 파일 획득

---

### 방법 2: WSL2로 빌드 (30분 소요)

#### 1. WSL2 설치 (최초 1회)

PowerShell (관리자):
```powershell
wsl --install
```

재부팅 후 계속

#### 2. WSL2에서 환경 설정

```bash
# Java 17 설치
sudo apt update
sudo apt install openjdk-17-jdk -y

# Node.js 설치
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Android SDK 설치
mkdir -p ~/android-sdk/cmdline-tools
cd ~/android-sdk/cmdline-tools
wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip
unzip commandlinetools-linux-9477386_latest.zip
mv cmdline-tools latest

# 환경변수
echo 'export ANDROID_HOME=$HOME/android-sdk' >> ~/.bashrc
echo 'export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin' >> ~/.bashrc
source ~/.bashrc

# SDK 컴포넌트
sdkmanager --install "platform-tools" "platforms;android-34" "build-tools;34.0.0" "ndk;25.2.9519653"
```

#### 3. 빌드 실행

```bash
cd /mnt/c/app_build/Iexist/frontend
npm install
cd android
chmod +x gradlew
./gradlew assembleRelease
```

APK 위치: `/mnt/c/app_build/Iexist/frontend/android/app/build/outputs/apk/release/app-release.apk`

---

### 방법 3: Android Studio GUI 빌드 (가장 안전)

#### 1. Android Studio 실행

#### 2. 프로젝트 열기
- File → Open
- `C:\app_build\Iexist\frontend\android` 선택

#### 3. Gradle Sync 완료 대기
- 하단 상태바에서 "Gradle sync finished" 확인

#### 4. 빌드
- Build → Build Bundle(s) / APK(s) → Build APK(s)
- 완료 후 "locate" 링크 클릭하여 APK 확인

---

## 📋 빌드 후 테스트

### 로컬 기기에 설치

```bash
adb install -r "경로\app-release.apk"
```

또는 APK 파일을 기기로 전송 후 직접 설치

### 테스트 체크리스트

- [ ] 앱 실행
- [ ] 수정한 오류 부분 확인
- [ ] 주요 기능 정상 작동 확인
- [ ] 로그인/로그아웃
- [ ] API 통신 정상 확인

---

## 🚀 Google Play 스토어 배포

### 1. 버전 업데이트

`frontend/android/app/build.gradle`:

```gradle
versionCode 12  // 이전보다 +1 증가
versionName "1.1.9"  // 버전명 업데이트
```

### 2. App Bundle 빌드

```bash
cd frontend/android
./gradlew bundleRelease
```

AAB 파일 위치: `app/build/outputs/bundle/release/app-release.aab`

### 3. Play Console 업로드

1. Google Play Console 접속
2. 앱 선택 → 프로덕션
3. "새 버전 만들기"
4. AAB 파일 업로드
5. 출시 노트 작성
6. "검토" → "프로덕션으로 출시"

### 4. 출시 시간

- 검토: 수 시간 ~ 며칠
- 긴급 수정: Play Console에 긴급 업데이트 요청 가능

---

## 🔧 향후 개선 사항

### CI/CD 파이프라인 구축 완료

GitHub Actions workflow가 설정되어 있어 이제부터는:

1. 코드 수정
2. `git push`
3. 자동으로 APK/AAB 빌드
4. 다운로드하여 테스트/배포

### 개발 프로세스 개선

```
개발 → 로컬 테스트 → Git Push →
자동 빌드 → 내부 테스트 → Play 스토어 배포
```

---

## ⚠️ 주의사항

### Keystore 보안

- **절대** Git에 커밋하지 말 것
- GitHub Secrets로 안전하게 관리
- 백업 필수 (분실 시 재배포 불가)

### .env 파일

- API_URL, 키값 등 실제 값 사용
- 프로덕션/개발 환경 분리

### 테스트

긴급 상황이라도 최소한의 테스트 필수:
- 앱 실행
- 수정 부분 확인
- 크리티컬한 기능 정상 작동 확인

---

## 📞 긴급 지원

빌드가 계속 실패하는 경우:

1. GitHub Actions 빌드 로그 확인
2. WSL2 환경에서 빌드 시도
3. 이전 작동하던 버전으로 롤백

---

*이 가이드는 긴급 상황을 위한 임시 해결책과 장기적인 개선 방안을 포함합니다.*
*정상적인 개발/배포 프로세스는 GitHub Actions를 통한 자동화를 권장합니다.*
